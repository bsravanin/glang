#! /bin/bash

if [[ $PWD != *"/glang/frontend" ]]; then
	echo "ERROR: Please run this script from glang/frontend directory."
	exit 65
fi

if [ $# -ne 2 ]; then
	echo "Usage: $0 <gramola_src_prog> <java_target_class_name>"
	exit 65
fi

SOURCE=$1
JTARGET=$2
TARGET_DIR=../src
BIN_DIR=../bin
CLASSPATH=../lib/*:.

if [ ! -d ../bin ]; then
	mkdir ../bin
fi

if [ ! -e ../lib/gramola.jar ]; then
	echo "ERROR: Could not find gramola.jar."
	exit 1
fi

python codegen.py $SOURCE $JTARGET
rm $TARGET_DIR/*.java
mv *.java $TARGET_DIR
javac -cp $CLASSPATH ${TARGET_DIR}/*.java
rm $BIN_DIR/*.class
mv ${TARGET_DIR}/*.class $BIN_DIR
